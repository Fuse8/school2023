<p align="center">
  <img src="/assets/logo.png" alt="logo" title="Летняя стажировка fuse8/byteminds"/>
</p>

# Задание к уроку №7

## InternalApi
- Добавить и настроить `DbContext`
- Установить схему для `DbContext` - `cur`
- Создать пустую инициальную миграцию
- Добавить таблицы, для хранения кэша `ICachedCurrencyAPI` 
- Дополнительно на свое усмотрение вы можете добавить индексы и ограничения к созданным таблицам
- Переделать сервис `ICachedCurrencyAPI` на использование базы данных, вместо сохранения на диск


## PublicApi
- Добавить и настроить `DbContext`
- Установить схему для `DbContext` - `user`
- Создать пустую инициальную миграцию
- Перенести в базу данных настройки из конфига - `defaultCurrency` и `currencyRoundCount` (курс валют по умолчанию и Количество знаков после запятой, до которого следует округлять значение курса валют)
- Добавить методы апи управления настройками
  - Изменить Валюту по умолчанию
  - Изменить Количество знаков после запятой для округления
- Добавить таблицу для хранения Избранных курсов валют. У сущности должно быть поле с названием, поле с валютой и поле с базовой валютой
```
{
  "Name": "RubToEuro",
  "Currency": "RUB",
  "BaseCurrency": "EUR"
}
```
- Настроить таблицу Избранных валют
  - Название должно быть уникальным
  - В таблице не может быть двух записей с одинаковыми валютой и базовой валютой. Т.е. если в таблице есть запись `("RubToEuro", "RUB", "EUR")`, нельзя будет добавить `("AnotherName", "RUB", "EUR")`
- Дополнительно на свое усмотрение вы можете добавить индексы и ограничения к созданным таблицам

- Для управления Избранным добавить методы в апи
  - Получить Избранное по его названию
  - Получить список всех Избранных
  - Добавить новое Избранное. В методе добавления проверять те же ограничения, которые наложены на таблицу в бд (уникальность имени, уникальность валют)
  - Изменить Избранное по его названию. В методе изменения проверять те же ограничения, которые наложены на таблицу в бд (уникальность имени, уникальность валют)
  - Удалить Избранное по его названию

- Добавить метод для получения *текущего* курса для Избранного по его названию в `PublicApi`
  - Метод должен вызывать `grpc-сервис`
  - `grpc-сервис` в `InternalApi` должен получать курс Избранного `FAV_CUR` относительно базовой валюты Избранного `FAV_CUR_BASE` по следующему алгоритму
    - Если данные в кэше устарели - получить актуальные данные
    - Получить курс для валюты `FAV_CUR` относительно базовой валюты `CACHE_BASE` из кэша (`CACHE_BASE` - базовая валюта, относительно которой строится кэш)
    - Если базовая валюта кэша `CACHE_BASE` равна базовой валюте Избранного `FAV_CUR_BASE`
      - В качестве результата вернуть полученное значение курса для `FAV_CUR` 
    - Иначе
      - Получить курс для валюты `FAV_CUR_BASE` относительно базовой валюты `CACHE_BASE` из кэша 
      - В качестве результата вернуть `FAV_CUR / FAV_CUR_BASE`
  - Пример получения курса рубля относительно евро. Базовая валюта, относительно которой строится кэш - доллар
    - `FAV_CUR` = `RUB`
    - `FAV_CUR_BASE` = `EUR`
    - `CACHE_BASE` = `USD`
    - Получаем курс для `RUB` относительно `USD` = `95.9903962843`
    - Получаем курс для `EUR` относительно `USD` = `0.9165901128` 
    - Получаем курс рубля относительно евро = `95.9903962843 / 0.9165901128 = 104.725541923` 
- Добавить метод для получения курса для Избранного по его названию в `PublicApi` *на конкретную дату* (алгоритм такой же, что и при получении текущего курса)
